# Ethers Scripts

A collection of Ethereum development scripts using ethers.js v6 for interacting with the Ethereum blockchain. This project follows the Buidl Guidl's [Web2 to Web3 Curriculum Week#2](https://www.youtube.com/watch?v=zuJ-elbo88E&list=PLJz1HruEnenAf80uOfDwBPqaliJkjKg69), progressing from basic blockchain interactions to smart contract development.

## Overview

This repository contains practical examples of Ethereum blockchain interactions using ethers.js v6, organized by learning progression:

**Day 1 - Blockchain Basics:**
- **Provider Setup**: Connecting to Ethereum networks via Infura
- **Wallet Management**: Creating and managing wallets
- **Balance Queries**: Checking ETH balances
- **Transaction Sending**: Sending ETH transactions
- **Message Signing**: Signing and verifying messages

**Day 2 - Smart Contract Interactions:**
- **Contract Reading**: Reading data from smart contracts
- **Contract Writing**: Writing transactions to smart contracts
- **ERC-20 Token Operations**: Interacting with DAI token contract
- **NFT Operations**: Reading and minting NFTs
- **Utility Functions**: Reusable provider and signer utilities

**Day 3 - Smart Contract Development:**
- **Hardhat Framework**: Full development environment with compilation, testing, and deployment
- **Solidity Development**: Writing and testing smart contracts with lock/unlock mechanisms
- **Test-Driven Development**: Comprehensive testing with Mocha and Foundry-style tests
- **Multi-Network Deployment**: Local, Sepolia, and simulated network configurations
- **Contract Verification**: Etherscan integration for contract verification
- **Utility Scripts**: Blockchain interaction scripts for different networks

**Day 4 - Testing Patterns:**
- **Dual Testing Frameworks**: Foundry (Solidity) and Hardhat (TypeScript) approaches
- **Fuzz Testing**: Automated randomized input testing with Foundry
- **Simple Counter Contract**: Clean implementation for learning testing fundamentals

## Project Structure

```
ethers-scripts/
├── package.json          # Dependencies and scripts
├── day1/                 # Day 1: Blockchain Basics
│   ├── providers.js      # Provider setup and balance queries
│   ├── wallets.js        # Wallet creation and HD wallet generation
│   └── walletOps.js      # Wallet operations (signing, transactions)
├── day2/                 # Day 2: Smart Contract Interactions
│   ├── abi/              # Smart contract ABIs
│   │   ├── daiAbi.js     # DAI token contract ABI
│   │   └── yourCollectibleAbi.js # NFT contract ABI
│   ├── contract_dai_ops.js    # DAI token contract interactions
│   ├── contract_read.js        # Reading NFT contract data
│   ├── contract_write.js       # Writing to NFT contract (minting)
│   ├── get_address.js          # Get wallet address and balance
│   ├── sendETH.js              # Send ETH transactions
│   └── utils.js                # Utility functions (providers, signers)
├── day3/                 # Day 3: Smart Contract Development (Hardhat)
│   ├── contracts/        # Solidity smart contracts
│   │   ├── Counter.sol   # Counter contract with lock/unlock mechanism
│   │   └── Counter.t.sol # Foundry-style Solidity tests
│   ├── test/             # TypeScript tests
│   │   └── Counter.ts    # Mocha tests for Counter contract
│   ├── ignition/         # Hardhat Ignition deployment modules
│   │   └── modules/Counter.ts # Counter deployment configuration
│   ├── scripts/          # Utility scripts for blockchain interaction
│   │   ├── contracts.js  # Interact with deployed Counter on localhost
│   │   ├── getBalance.js # Check balance on simulated Optimism network
│   │   ├── getSepoliaSigner.js # Connect to Sepolia and get signer info
│   │   └── sendETH.js    # Send ETH transactions with safety checks
│   ├── hardhat.config.ts # Hardhat configuration with multi-network support
│   ├── package.json      # Day 3 specific dependencies
│   └── README.md         # Hardhat project documentation
├── day4/                 # Day 4: Testing Patterns
│   ├── contracts/        # Clean contract implementations
│   │   ├── Counter.sol   # Simple counter with increment/decrement operations
│   │   └── Counter.t.sol # Foundry tests with fuzz testing and assertions
│   └── test/             # Hardhat TypeScript tests
│       └── Counter.ts    # Integration tests using ethers deployment patterns
├── .env                  # Environment variables (create this)
└── README.md            # This file
```

## Setup

### Prerequisites

- Node.js (v16 or higher)
- npm or yarn
- An Infura API key

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd ethers-scripts
```

2. Install dependencies:
```bash
npm install
```

3. Create a `.env` file in the root directory:
```env
# Your Infura API key
INFURA_KEY=

# Private key from one of the accounts generated by wallets.js
WALLET_PRIVATE_KEY=

# Public address corresponding to the WALLET_PRIVATE_KEY
WALLET_PUBLIC_ADDRESS=

# Destination address for sending ETH transactions
TO_ADDRESS=

# Etherscan API key for contract verification (Day 3)
ETHERSCAN_API_KEY=
```

4. For Day 3 Hardhat development, install additional dependencies:
```bash
cd day3
npm install
```

## Scripts

### Day 1 Scripts (Blockchain Basics)

#### day1/providers.js

Demonstrates provider setup and basic blockchain queries:

- Connecting to Ethereum networks via Infura
- Resolving ENS names to addresses
- Looking up ENS names from addresses
- Checking ETH balances
- Comparing balances between addresses

**Run with:**
```bash
node day1/providers.js
```

**Features:**
- Provider instantiation with Infura
- ENS resolution (`atg.eth` → address)
- Reverse ENS lookup (address → ENS name)
- Balance comparison between two addresses
- BigInt arithmetic for balance calculations

#### day1/wallets.js

Demonstrates wallet creation and HD wallet generation:

- Creating random wallets with mnemonics
- Generating multiple accounts from a single mnemonic phrase
- HD wallet derivation using BIP-44 paths

**Run with:**
```bash
node day1/wallets.js
```

**Features:**
- Random wallet generation with mnemonic phrase
- HD wallet derivation (10 accounts from same mnemonic)
- BIP-44 path generation for different account indices
- Private key and address generation for each account

#### day1/walletOps.js

Demonstrates wallet operations and transaction functionality:

- Message signing and verification
- Sending ETH transactions
- Connecting wallets to providers
- Balance checking and transaction confirmation

**Run with:**
```bash
node day1/walletOps.js
```

**Features:**
- Message signing and verification
- Transaction sending on Sepolia testnet
- Balance checking before transactions
- Transaction confirmation waiting
- Provider-connected wallet operations

### Day 2 Scripts (Smart Contract Interactions)

#### day2/utils.js

Provides reusable utility functions for provider and signer management:

- `getProvider(mainnet)`: Creates JsonRpcProvider for mainnet or Sepolia
- `getSigner(mainnet)`: Creates wallet signer connected to provider
- `generateNewWallet()`: Generates new random wallet with mnemonic

**Features:**
- Network switching (mainnet/Sepolia) via boolean parameter
- Environment-based private key wallet creation
- Reusable across all day2 scripts

#### day2/get_address.js

Simple script to display wallet address and balance:

**Run with:**
```bash
node day2/get_address.js
```

**Features:**
- Displays wallet address from environment
- Shows current ETH balance on mainnet

#### day2/sendETH.js

Demonstrates ETH transfer functionality:

**Run with:**
```bash
node day2/sendETH.js
```

**Features:**
- Sends 10% of wallet balance to specified address
- Balance validation before sending
- Transaction confirmation waiting
- Uses Sepolia testnet

#### day2/contract_read.js

Demonstrates reading data from smart contracts:

**Run with:**
```bash
node day2/contract_read.js
```

**Features:**
- Reads totalSupply from YourCollectible NFT contract
- Uses contract ABI for function calls
- Read-only operations (no gas required)

#### day2/contract_write.js

Demonstrates writing to smart contracts (minting NFTs):

**Run with:**
```bash
node day2/contract_write.js
```

**Features:**
- Mints NFT using YourCollectible contract
- Shows two methods: raw transaction and contract method
- Uses function selector and calldata encoding
- Transaction confirmation and gas usage

#### day2/contract_dai_ops.js

Demonstrates ERC-20 token contract interactions:

**Run with:**
```bash
node day2/contract_dai_ops.js
```

**Features:**
- Reads DAI token balance
- Transfers DAI tokens to another address
- Balance checking before and after transfer
- Mainnet DAI contract interaction

### Day 3 Scripts (Smart Contract Development)

Day 3 introduces Hardhat, a comprehensive Ethereum development environment that provides compilation, testing, and deployment tools.

#### Setup and Testing

**Navigate to day3 directory:**
```bash
cd day3
```

**Run all tests:**
```bash
npx hardhat test
```

**Run specific test types:**
```bash
npx hardhat test solidity  # Run Foundry-style Solidity tests
npx hardhat test mocha     # Run TypeScript/Mocha tests
```

#### Smart Contract: Counter.sol

The Counter contract demonstrates:
- Basic state management with increment functionality
- Access control using a lock/unlock mechanism
- Event emission for blockchain activity tracking
- Comprehensive testing patterns

**Key features:**
- `inc()`: Increment counter by 1 (requires unlock)
- `incBy(uint by)`: Increment counter by specified amount (requires unlock)
- `toggleUnlocked()`: Toggle the lock state
- `Increment` event emission for all increments

#### Deployment

**Deploy to local Hardhat network:**
```bash
npx hardhat ignition deploy ignition/modules/Counter.ts
```

**Deploy to Sepolia testnet:**
```bash
npx hardhat ignition deploy --network sepolia ignition/modules/Counter.ts
```

**Verify contract on Etherscan:**
```bash
npx hardhat verify --network sepolia <CONTRACT_ADDRESS>
```

#### Utility Scripts

**day3/scripts/contracts.js**
Demonstrates contract interaction on localhost:
- Connects to locally deployed Counter contract
- Shows reading contract state (`x` value)
- Demonstrates contract method calls (`incBy`)
- Transaction confirmation handling

**Run with:**
```bash
# First start local Hardhat node in another terminal
npx hardhat node
# Then run the script
npx hardhat run scripts/contracts.js
```

**day3/scripts/getBalance.js**
Shows balance checking on simulated Optimism network:
- Connects to Hardhat's ephemeral simulated OP network
- Demonstrates cross-chain network configuration
- Balance queries using different network types
- Network spins up temporarily just for this script execution

**Run with:**
```bash
npx hardhat run scripts/getBalance.js
```

**day3/scripts/getSepoliaSigner.js**
Connects to Sepolia testnet:
- Environment-based wallet configuration
- Real testnet connection via Infura
- Signer address and balance display

**Run with:**
```bash
npx hardhat run scripts/getSepoliaSigner.js
```

**day3/scripts/sendETH.js**
ETH transfer with safety features:
- Balance validation before sending
- Sends 10% of available balance
- Transaction confirmation waiting
- Error handling for insufficient funds

**Run with:**
```bash
npx hardhat run scripts/sendETH.js
```

### Day 4 Scripts (Testing Patterns)

Demonstrates dual testing frameworks for comprehensive smart contract testing.

#### Smart Contract: Counter.sol (day4/contracts/Counter.sol)

Simple counter with `get()`, `inc()`, `dec()` functions, constructor initialization, and underflow protection.

#### Testing Strategy

**Foundry Tests (Counter.t.sol):**
- Native Solidity testing with `forge-std/Test.sol`
- **Fuzz testing**: `testFuzz_Inc(uint8 count)` runs tests with randomized inputs to catch edge cases
- State verification with `assertEq()` and error testing with `vm.expectRevert()`
- Gas-efficient, runs directly on EVM

**Hardhat Tests (Counter.ts):**
- TypeScript integration tests with Mocha and Chai
- Contract deployment simulation with `ethers.deployContract()`
- Transaction confirmation patterns with `.wait()`

**Run tests:**
```bash
cd day4
npx hardhat test              # Run all tests
npx hardhat test solidity     # Foundry tests only
npx hardhat test mocha        # Hardhat tests only
```

## Key Concepts

### BigInt vs BigNumber

In ethers v6, balance values are returned as **BigInt** instead of BigNumber objects:

```javascript
// ✅ Correct (ethers v6)
const balance = await provider.getBalance(address);
if (balance1 > balance2) { /* ... */ }
const newBalance = balance + ethers.parseEther("1.5");

// ❌ Incorrect (ethers v5 style)
if (balance1.gt(balance2)) { /* ... */ }
const newBalance = balance.add(ethers.parseEther("1.5"));
```

### Provider Setup

```javascript
const infuraUrl = `https://mainnet.infura.io/v3/${process.env.INFURA_KEY}`;
const provider = new ethers.JsonRpcProvider(infuraUrl);
```

### Wallet Creation

```javascript
// From private key
const wallet = new ethers.Wallet(privateKey);

// Random wallet
const randomWallet = ethers.Wallet.createRandom();

// HD wallet from mnemonic
const hdWallet = ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, path);
```

### Smart Contract Interactions

#### Contract Instances

```javascript
// Read-only contract (connected to provider)
const contract = new ethers.Contract(contractAddress, abi, provider);

// Write-capable contract (connected to signer)
const contractWithSigner = new ethers.Contract(contractAddress, abi, signer);
```

#### Reading Contract Data

```javascript
// No gas required for read operations
const totalSupply = await contract.totalSupply();
const balance = await tokenContract.balanceOf(address);
```

#### Writing to Contracts

```javascript
// Method 1: Using contract methods
const tx = await contractWithSigner.transfer(toAddress, amount);
await tx.wait(); // Wait for confirmation

// Method 2: Raw transaction with calldata
const calldata = contract.interface.encodeFunctionData("transfer", [toAddress, amount]);
const tx = await signer.sendTransaction({
    to: contractAddress,
    data: calldata,
    value: 0
});
```

### Contract ABIs

Contract ABIs (Application Binary Interface) define how to interact with smart contracts. An ABI is an array of JSON objects where each object represents either a function, event, constructor, fallback, receive or error. In ABIs in this project function, event and constructor elements are used in the interface:

```javascript
// Full ABI format (as used in this project)
const abi = [{
    "constant": true,
    "inputs": [],
    "name": "totalSupply",
    "outputs": [{
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
    }],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
}, {
    "constant": true,
    "inputs": [{
        "internalType": "address",
        "name": "",
        "type": "address"
    }],
    "name": "balanceOf",
    "outputs": [{
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
    }],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
}];

// Alternative: Human-readable ABI format (ethers.js also supports this)
const humanReadableAbi = [
    "function totalSupply() view returns (uint256)",
    "function balanceOf(address owner) view returns (uint256)",
    "function transfer(address to, uint256 amount) returns (bool)"
];
```

## Dependencies

**Root project:**
- **ethers**: ^6.14.1 - Ethereum library for JavaScript
- **dotenv**: ^16.5.0 - Environment variable management

**Day 3 (Hardhat project):**
- **hardhat**: ^3.0.3 - Ethereum development environment
- **@nomicfoundation/hardhat-toolbox-mocha-ethers**: ^3.0.0 - Hardhat toolbox with Mocha and ethers
- **@nomicfoundation/hardhat-ignition**: ^3.0.1 - Contract deployment system
- **mocha**: ^11.7.1 - JavaScript test framework
- **typescript**: ~5.8.0 - TypeScript compiler
- **dotenv**: ^17.2.2 - Environment variable management for Hardhat

## Networks

The scripts are configured to work with:

**Days 1-2:**
- **Mainnet**: For balance queries and ENS resolution
- **Sepolia**: For transaction testing (testnet)

**Day 3 (Hardhat):**
- **localhost**: Local Hardhat node (http://127.0.0.1:8545) - persistent while running
- **Sepolia**: Ethereum testnet via Infura - real network
- **hardhatMainnet**: Simulated Ethereum mainnet (ephemeral) - exists only during script execution
- **hardhatOp**: Simulated Optimism network (ephemeral) - exists only during script execution

## Common Issues

### BigInt Arithmetic Errors

If you see "Cannot mix BigInt and other types" errors:

```javascript
// ❌ Wrong
const result = balance / 10;

// ✅ Correct
const result = balance / 10n;
```

### Private Key Format

Ensure your private key in `.env` is clean:

```env
# ❌ Wrong (with quotes)
WALLET_PRIVATE_KEY="0x0000000000000000000000000000000000000000000000000000000000000000"

# ✅ Correct (no quotes)
WALLET_PRIVATE_KEY=0x0000000000000000000000000000000000000000000000000000000000000000
```

## Contributing

Feel free to submit issues and enhancement requests!

## License

MIT License
