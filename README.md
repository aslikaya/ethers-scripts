# Ethers Scripts

A collection of Ethereum development scripts using ethers.js v6 for interacting with the Ethereum blockchain. This project follows the Buidl Guidl's [Web2 to Web3 Curriculum Week#2](https://www.youtube.com/watch?v=zuJ-elbo88E&list=PLJz1HruEnenAf80uOfDwBPqaliJkjKg69), progressing from basic blockchain interactions to smart contract development.

## Overview

This repository contains practical examples of Ethereum blockchain interactions using ethers.js v6, organized by learning progression:

**Day 1 - Blockchain Basics:**
- **Provider Setup**: Connecting to Ethereum networks via Infura
- **Wallet Management**: Creating and managing wallets
- **Balance Queries**: Checking ETH balances
- **Transaction Sending**: Sending ETH transactions
- **Message Signing**: Signing and verifying messages

**Day 2 - Smart Contract Interactions:**
- **Contract Reading**: Reading data from smart contracts
- **Contract Writing**: Writing transactions to smart contracts
- **ERC-20 Token Operations**: Interacting with DAI token contract
- **NFT Operations**: Reading and minting NFTs
- **Utility Functions**: Reusable provider and signer utilities

## Project Structure

```
ethers-scripts/
├── package.json          # Dependencies and scripts
├── day1/                 # Day 1: Blockchain Basics
│   ├── providers.js      # Provider setup and balance queries
│   ├── wallets.js        # Wallet creation and HD wallet generation
│   └── walletOps.js      # Wallet operations (signing, transactions)
├── day2/                 # Day 2: Smart Contract Interactions
│   ├── abi/              # Smart contract ABIs
│   │   ├── daiAbi.js     # DAI token contract ABI
│   │   └── yourCollectibleAbi.js # NFT contract ABI
│   ├── contract_dai_ops.js    # DAI token contract interactions
│   ├── contract_read.js        # Reading NFT contract data
│   ├── contract_write.js       # Writing to NFT contract (minting)
│   ├── get_address.js          # Get wallet address and balance
│   ├── sendETH.js              # Send ETH transactions
│   └── utils.js                # Utility functions (providers, signers)
├── .env                  # Environment variables (create this)
└── README.md            # This file
```

## Setup

### Prerequisites

- Node.js (v16 or higher)
- npm or yarn
- An Infura API key

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd ethers-scripts
```

2. Install dependencies:
```bash
npm install
```

3. Create a `.env` file in the root directory:
```env
# Your Infura API key
INFURA_KEY=

# Private key from one of the accounts generated by wallets.js
WALLET_PRIVATE_KEY=

# Public address corresponding to the WALLET_PRIVATE_KEY
WALLET_PUBLIC_ADDRESS=

# Destination address for sending ETH transactions
TO_ADDRESS=
```

## Scripts

### Day 1 Scripts (Blockchain Basics)

#### day1/providers.js

Demonstrates provider setup and basic blockchain queries:

- Connecting to Ethereum networks via Infura
- Resolving ENS names to addresses
- Looking up ENS names from addresses
- Checking ETH balances
- Comparing balances between addresses

**Run with:**
```bash
node day1/providers.js
```

**Features:**
- Provider instantiation with Infura
- ENS resolution (`atg.eth` → address)
- Reverse ENS lookup (address → ENS name)
- Balance comparison between two addresses
- BigInt arithmetic for balance calculations

#### day1/wallets.js

Demonstrates wallet creation and HD wallet generation:

- Creating random wallets with mnemonics
- Generating multiple accounts from a single mnemonic phrase
- HD wallet derivation using BIP-44 paths

**Run with:**
```bash
node day1/wallets.js
```

**Features:**
- Random wallet generation with mnemonic phrase
- HD wallet derivation (10 accounts from same mnemonic)
- BIP-44 path generation for different account indices
- Private key and address generation for each account

#### day1/walletOps.js

Demonstrates wallet operations and transaction functionality:

- Message signing and verification
- Sending ETH transactions
- Connecting wallets to providers
- Balance checking and transaction confirmation

**Run with:**
```bash
node day1/walletOps.js
```

**Features:**
- Message signing and verification
- Transaction sending on Sepolia testnet
- Balance checking before transactions
- Transaction confirmation waiting
- Provider-connected wallet operations

### Day 2 Scripts (Smart Contract Interactions)

#### day2/utils.js

Provides reusable utility functions for provider and signer management:

- `getProvider(mainnet)`: Creates JsonRpcProvider for mainnet or Sepolia
- `getSigner(mainnet)`: Creates wallet signer connected to provider
- `generateNewWallet()`: Generates new random wallet with mnemonic

**Features:**
- Network switching (mainnet/Sepolia) via boolean parameter
- Environment-based private key wallet creation
- Reusable across all day2 scripts

#### day2/get_address.js

Simple script to display wallet address and balance:

**Run with:**
```bash
node day2/get_address.js
```

**Features:**
- Displays wallet address from environment
- Shows current ETH balance on mainnet

#### day2/sendETH.js

Demonstrates ETH transfer functionality:

**Run with:**
```bash
node day2/sendETH.js
```

**Features:**
- Sends 10% of wallet balance to specified address
- Balance validation before sending
- Transaction confirmation waiting
- Uses Sepolia testnet

#### day2/contract_read.js

Demonstrates reading data from smart contracts:

**Run with:**
```bash
node day2/contract_read.js
```

**Features:**
- Reads totalSupply from YourCollectible NFT contract
- Uses contract ABI for function calls
- Read-only operations (no gas required)

#### day2/contract_write.js

Demonstrates writing to smart contracts (minting NFTs):

**Run with:**
```bash
node day2/contract_write.js
```

**Features:**
- Mints NFT using YourCollectible contract
- Shows two methods: raw transaction and contract method
- Uses function selector and calldata encoding
- Transaction confirmation and gas usage

#### day2/contract_dai_ops.js

Demonstrates ERC-20 token contract interactions:

**Run with:**
```bash
node day2/contract_dai_ops.js
```

**Features:**
- Reads DAI token balance
- Transfers DAI tokens to another address
- Balance checking before and after transfer
- Mainnet DAI contract interaction

## Key Concepts

### BigInt vs BigNumber

In ethers v6, balance values are returned as **BigInt** instead of BigNumber objects:

```javascript
// ✅ Correct (ethers v6)
const balance = await provider.getBalance(address);
if (balance1 > balance2) { /* ... */ }
const newBalance = balance + ethers.parseEther("1.5");

// ❌ Incorrect (ethers v5 style)
if (balance1.gt(balance2)) { /* ... */ }
const newBalance = balance.add(ethers.parseEther("1.5"));
```

### Provider Setup

```javascript
const infuraUrl = `https://mainnet.infura.io/v3/${process.env.INFURA_KEY}`;
const provider = new ethers.JsonRpcProvider(infuraUrl);
```

### Wallet Creation

```javascript
// From private key
const wallet = new ethers.Wallet(privateKey);

// Random wallet
const randomWallet = ethers.Wallet.createRandom();

// HD wallet from mnemonic
const hdWallet = ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, path);
```

### Smart Contract Interactions

#### Contract Instances

```javascript
// Read-only contract (connected to provider)
const contract = new ethers.Contract(contractAddress, abi, provider);

// Write-capable contract (connected to signer)
const contractWithSigner = new ethers.Contract(contractAddress, abi, signer);
```

#### Reading Contract Data

```javascript
// No gas required for read operations
const totalSupply = await contract.totalSupply();
const balance = await tokenContract.balanceOf(address);
```

#### Writing to Contracts

```javascript
// Method 1: Using contract methods
const tx = await contractWithSigner.transfer(toAddress, amount);
await tx.wait(); // Wait for confirmation

// Method 2: Raw transaction with calldata
const calldata = contract.interface.encodeFunctionData("transfer", [toAddress, amount]);
const tx = await signer.sendTransaction({
    to: contractAddress,
    data: calldata,
    value: 0
});
```

### Contract ABIs

Contract ABIs (Application Binary Interface) define how to interact with smart contracts. An ABI is an array of JSON objects where each object represents either a function, event, constructor, fallback, receive or error. In ABIs in this project function, event and constructor elements are used in the interface:

```javascript
// Full ABI format (as used in this project)
const abi = [{
    "constant": true,
    "inputs": [],
    "name": "totalSupply",
    "outputs": [{
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
    }],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
}, {
    "constant": true,
    "inputs": [{
        "internalType": "address",
        "name": "",
        "type": "address"
    }],
    "name": "balanceOf",
    "outputs": [{
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
    }],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
}];

// Alternative: Human-readable ABI format (ethers.js also supports this)
const humanReadableAbi = [
    "function totalSupply() view returns (uint256)",
    "function balanceOf(address owner) view returns (uint256)",
    "function transfer(address to, uint256 amount) returns (bool)"
];
```

## Dependencies

- **ethers**: ^6.14.1 - Ethereum library for JavaScript
- **dotenv**: ^16.5.0 - Environment variable management

## Networks

The scripts are configured to work with:

- **Mainnet**: For balance queries and ENS resolution
- **Sepolia**: For transaction testing (testnet)

## Common Issues

### BigInt Arithmetic Errors

If you see "Cannot mix BigInt and other types" errors:

```javascript
// ❌ Wrong
const result = balance / 10;

// ✅ Correct
const result = balance / 10n;
```

### Private Key Format

Ensure your private key in `.env` is clean:

```env
# ❌ Wrong (with quotes)
WALLET_PRIVATE_KEY="0x0000000000000000000000000000000000000000000000000000000000000000"

# ✅ Correct (no quotes)
WALLET_PRIVATE_KEY=0x0000000000000000000000000000000000000000000000000000000000000000
```

## Contributing

Feel free to submit issues and enhancement requests!

## License

MIT License
